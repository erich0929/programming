<?xml version="1.0" ?>

<project name="FileDownload_standalone" default="default">

	<!-- Load generally common properties, such as javac.debug -->
	<property file="common.properties" />

	<patternset id="java.files.pattern" includes="**/*.java" />

	<target name="clean" description="Removes build artifacts">
		<echo level="info">Removes build artifacts...</echo>
		<delete dir="${temp.dir}" />
		<mkdir dir="${temp.dir}" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.pims.dir}" />
	</target>

	<target name="init" depends="clean" description="Initialize condition and path">
		<echo level="info">Initialize condition and path...</echo>
		<condition property="os.family" value="unix">
			<os family="unix" />
		</condition>
		<condition property="os.family" value="windows">
			<os family="windows" />
		</condition>

		<path id="compile.classpath">
			<fileset dir="${lib.dir}" includes="*.jar" />
			<fileset dir="${lib.dir}/${os.family}" includes="*.jar" />
		</path>
	</target>

	<target name="build" depends="init">
		<echo level="info">Makes all directories and compile, build ${project.name}.jar file...</echo>

		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.dir}/classes" />
		<javac srcdir="src" destdir="${build.dir}/classes" debug="${javac.debug}" classpathref="compile.classpath" />

		<mkdir dir="${dist.pims.dir}/lib" />
		<jar destfile="${dist.pims.dir}/lib/${project.name}.jar">
			<fileset dir="${build.dir}/classes" />

			<fileset dir="src">
				<exclude name="**/*.java" />
			</fileset>
		</jar>
		<delete dir="${build.dir}" />
	</target>

	<target name="package" depends="build">
		<echo level="info">Packages standalone application...</echo>

		<copy todir="${dist.pims.dir}/lib">
			<fileset dir="${lib.dir}">
				<filename name="**/*.jar" />
			</fileset>
			<fileset dir="${lib.dir}">
				<filename name="**/*.zip" />
			</fileset>
		</copy>
		<copy todir="${dist.pims.dir}/lib/nativelib">
			<fileset dir="${lib.dir}/windows">
				<filename name="**/*.dll" />
			</fileset>
		</copy>
		<copydir src="${basedir}/client" dest="${dist.pims.dir}" />
	</target>

	<target name="deploy" depends="package" description="Archive ZIP">
		<delete file="${temp.dir}/${project.name}.zip" />
		<zip destfile="${temp.dir}/${project.name}.zip" basedir="${dist.pims.dir}" compress="true" />

		<delete dir="${dist.pims.dir}" />
	</target>

	<target name="run" depends="build">

		<echo message="${lib.dir}/${os.family}" />

		<java classname="${mainClass.name}" fork="true">
			<jvmarg value="-Djava.library.path=${lib.dir}/${os.family}" />
			<classpath>
				<pathelement location="${dist.pims.dir}/lib/${project.name}.jar" />
				<fileset dir="${lib.dir}" includes="*.jar" />
				<fileset dir="${lib.dir}" includes="*.zip" />
				<fileset dir="${lib.dir}/${os.family}" includes="*.jar" />
			</classpath>
		</java>

	</target>

	<!-- Convenience targets -->
	<target name="default" depends="run" />

</project>

